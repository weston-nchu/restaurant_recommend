<!DOCTYPE html>
<html>
   <head>
    <meta charset="utf-8">
        <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">
        <title>Michelin Recommend</title>
        <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="/assets/css/font-awesome.css">
        <link rel="stylesheet" href="/assets/css/Restaurant.css">
        <link rel="stylesheet" href="/assets/css/owl-carousel.css">
        <link rel="stylesheet" href="/assets/css/lightbox.css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    </head>
    <body>
        <div style="min-height: 100px;">
            <header class="header-area header-sticky">
                <div class="container">
                    <div class="row">
                        <div class="col-12">
                            <nav class="main-nav">
                                <!-- ***** Logo Start ***** -->
                                <a href="/index" class="logo">
                                    <img src="/assets/images/michelin.png">
                                </a>
                                <!-- ***** Logo End ***** -->
                                <!-- ***** Menu Start ***** -->
                                <ul class="nav">
                                    <li class="scroll-to-section"><a href="/index" class="active">Home</a></li>
                                       
                                <!-- 
                                    <li class="submenu">
                                        <a href="javascript:;">Drop Down</a>
                                        <ul>
                                            <li><a href="#">Drop Down Page 1</a></li>
                                            <li><a href="#">Drop Down Page 2</a></li>
                                            <li><a href="#">Drop Down Page 3</a></li>
                                        </ul>
                                    </li>
                                
                                    <li class="scroll-to-section"><a href="#menu">Menu</a></li>
                                    <li class="scroll-to-section"><a href="#chefs">Chefs</a></li> 
                                    <li class="submenu">
                                        <a href="javascript:;">Features</a>
                                        <ul>
                                            <li><a href="#">Features Page 1</a></li>
                                            <li><a href="#">Features Page 2</a></li>
                                            <li><a href="#">Features Page 3</a></li>
                                            <li><a href="#">Features Page 4</a></li>
                                        </ul>
                                    </li>-->
                                    <!-- <li class=""><a rel="sponsored" href="https://templatemo.com" target="_blank">External URL</a></li> -->
                                </ul>        
                                <a class='menu-trigger'>
                                    <span>Menu</span>
                                </a>
                                <!-- ***** Menu End ***** -->
                            </nav>
                        </div>
                    </div>
                </div>
            </header>
        </div>
        
        <div class="row">
            <div class="col-6">
                <div class="container">
                    <div class="search-bar">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Restaurant name, style..." aria-label="Search" aria-describedby="search-addon">
                            <button class="btn btn-outline-secondary" type="button" id="search-addon">
                                    <i class="fas fa-search"></i>
                                </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div id = "recommendTag" container py-3" style="margin-right: 260px;margin-top: 10px;">
                    <div class="row">
                        <div class="col-auto">
                            <span class="suggestion-tag">#Most viewed</span>
                        </div>
                        <div class="col-auto">
                            <span class="suggestion-tag">#Japanese food</span>
                        </div>
                        <div class="col-auto">
                            <span class="suggestion-tag">#Taiwanese food</span>
                        </div>
                        <div class="col-auto">
                            <span class="suggestion-tag">#Comfortable</span>
                        </div>
                        <div class="col-auto">
                            <span class="suggestion-tag">#Recommend</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <section class="section" id="chefs">
            <div id="showRestaurant" class="container">
                
            </div>
        </section>

        <!-- ***** Footer Start ***** -->
        <footer>
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 col-xs-12">
                        <div class="right-text-content">
                                <ul class="social-icons">
                                    <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                                    <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                                    <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
                                    <li><a href="#"><i class="fa fa-instagram"></i></a></li>
                                </ul>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="logo">
                            <a href="index.html"><img src="/assets/images/WhiteLogo.png" alt=""></a>
                        </div>
                    </div>
                    <div class="col-lg-4 col-xs-12">
                        <div class="left-text-content">
                            <p>© Copyright Michelin Guide Recommend Platfrom.
                            
                            <br></p>
                        </div>
                    </div>
                </div>
            </div>
        </footer>

        <!-- jQuery -->
        <script src="/assets/js/jquery-2.1.0.min.js"></script>

        <!-- Bootstrap -->
        <script src="/assets/js/popper.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>

        <!-- Plugins -->
        <script src="/assets/js/owl-carousel.js"></script>
        <script src="/assets/js/accordions.js"></script>
        <script src="/assets/js/datepicker.js"></script>
        <script src="/assets/js/scrollreveal.min.js"></script>
        <script src="/assets/js/waypoints.min.js"></script>
        <script src="/assets/js/jquery.counterup.min.js"></script>
        <script src="/assets/js/imgfix.min.js"></script> 
        <script src="/assets/js/slick.js"></script> 
        <script src="/assets/js/lightbox.js"></script> 
        <script src="/assets/js/isotope.js"></script> 
        
        <!-- Global Init -->
        <script src="/assets/js/custom.js"></script>
        <script>
            let jsonResult = [];
            let search = [];

            //document.ready;
            document.addEventListener('DOMContentLoaded', async function(){
                const showRestaurant = document.getElementById('showRestaurant');
                const apiUrl = 'http://localhost:8080/search/restaurant';//api url

                const response = await fetch(apiUrl, {
                        method: 'POST', 
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(search)
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        showRestaurant.innerHTML = ''; //清空原有的載入中提示
                        jsonResult = data.content;
                        presentRestaurant();
                    });
            });

            document.addEventListener('DOMContentLoaded', function(){
                const recommendTag = document.getElementById('recommendTag');
                const apiUrl = 'http://localhost:8080/search/popular-tags';//api url

                fetch(apiUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(Data => {
                        recommendTag.innerHTML = ''; //清空原有的載入中提示
                        console.log(Data.content);
                        
                        let tagData = Data.content;
                        const newRowDiv = document.createElement('div');
                        newRowDiv.classList.add('row');
                        
                        for (i=0;i<tagData.length;i++){
                            const colAuto = document.createElement('div');
                            colAuto.classList.add('col-auto');
                            colAuto.setAttribute('onclick', `searchTag('${tagData[i]}')`);
                            colAuto.innerHTML = `<span class="suggestion-tag">
                                    #${tagData[i]}
                                </span>
                            `;
                            
                            newRowDiv.appendChild(colAuto);
                            recommendTag.appendChild(newRowDiv);
                            recommendTag.style.margin = "2% 0% 2% 6%";
                        }

                    });
            });

            function presentRestaurant(){
                const showRestaurant = document.getElementById('showRestaurant');
                showRestaurant.innerHTML = ''; //清空原有的載入中提示
                const newRowDiv = document.createElement('div');
                newRowDiv.classList.add('row');

                for(var i=0 ; i < jsonResult.length; i++){
                    // if(i%3 == 0){
                    //     const newRowDiv = document.createElement('div');
                    //     newRowDiv.classList.add('row');
                    //     newRowDiv.style.paddingBottom = "10px";
                    // }

                    const colDiv = document.createElement('div');
                    colDiv.classList.add('col-lg-3');
                    colDiv.style.paddingBottom = "20px";

                    const chefItemDiv = document.createElement('div');
                    chefItemDiv.classList.add('chef-item');

                    // 創建 .thumb 區塊 (圖片輪播和覆蓋層)
                    const thumbDiv = document.createElement('div');
                    thumbDiv.classList.add('thumb');

                    const mainBannerDiv = document.createElement('div');
                    mainBannerDiv.classList.add('main-banner', 'header-text');

                    const modernSliderDiv = document.createElement('div');
                    modernSliderDiv.classList.add('Modern-Slider');

                    // 輪播圖片
                    jsonResult[i].images.forEach(imageUrl => {
                        const itemDiv = document.createElement('div');
                        itemDiv.classList.add('item');
                        const imgFillDiv = document.createElement('div');
                        imgFillDiv.classList.add('img-fill');
                        const img = document.createElement('img');
                        img.src = imageUrl;
                        imgFillDiv.appendChild(img);
                        itemDiv.appendChild(imgFillDiv);
                        modernSliderDiv.appendChild(itemDiv);
                    });
                    
                    mainBannerDiv.appendChild(modernSliderDiv);
                    thumbDiv.appendChild(mainBannerDiv);

                    // 創建 .down-content 區塊 (餐廳資訊)
                    const downContentDiv = document.createElement('div');
                    downContentDiv.classList.add('down-content');
                    // 將餐廳的 UID 傳入 choose 函式
                    //downContentDiv.setAttribute('onclick', `choose('${jsonResult[restCounter][i].uid}')`);
                    const url = jsonResult[i].url;
                    downContentDiv.addEventListener('click', function() {
                        window.open(url, '_blank');
                    });

                    downContentDiv.innerHTML = `
                        <h4>${jsonResult[i].name}</h4>
                        <br><br>
                        <p>${jsonResult[i].desc}</p>
                    `;

                    chefItemDiv.appendChild(thumbDiv);
                    chefItemDiv.appendChild(downContentDiv);
                    colDiv.appendChild(chefItemDiv);

                    newRowDiv.appendChild(colDiv);
                    showRestaurant.appendChild(newRowDiv);
                }
                
                $('.Modern-Slider').slick({
                    autoplay:true,
                    autoplaySpeed:10000,
                    speed:600,
                    slidesToShow:1,
                    slidesToScroll:1,
                    pauseOnHover:true,
                    dots:true,
                    pauseOnDotsHover:true,
                    cssEase:'linear',
                    fade:true,
                    draggable:false,
                    prevArrow:'<button class="PrevArrow"></button>',
                    nextArrow:'<button class="NextArrow"></button>',
                });
            }

            async function searchTag(searchTag) {
                const showRestaurant = document.getElementById('showRestaurant');
                const apiUrl = 'http://localhost:8080/search/restaurant';//api url
                search.push(searchTag);
                const response = await fetch(apiUrl, {
                        method: 'POST', 
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(search)
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        showRestaurant.innerHTML = ''; //清空原有的載入中提示
                        jsonResult = data.content;
                        presentRestaurant();
                    });
            }
        </script>
    </body>
</html>